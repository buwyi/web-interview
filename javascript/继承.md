## ç»§æ‰¿

### åŸå‹é“¾ç»§æ‰¿ï¼Œæ„é€ å‡½æ•°ç»§æ‰¿ï¼Œç»„åˆç»§æ‰¿ï¼Œå¯„ç”Ÿç»„åˆç»§æ‰¿

åœ¨å¼€å§‹äº†è§£ç»§æ‰¿ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆäº†è§£ new çš„æœºåˆ¶ï¼Œè¿™æ®µä»£ç ä¿®æ”¹ prototype å±æ€§å¯¼è‡´ constructor å›æº¯åˆ°äº† object

```javascript
function A() {}
A.prototype = {
  sayHi() {
    console.log("Hi");
  },
};

const a = new A();
console.log(a.constructor === A); // âŒ false
console.log(a.constructor); // Objectï¼Œå› ä¸º constructor é»˜è®¤æŒ‡å‘ Object
```

è¿™ä¸ªç°è±¡çš„æœ¬è´¨æ ¹æºï¼Œåœ¨äº `new` å…³é”®å­—åœ¨å®ä¾‹åŒ–æ—¶çš„è¡Œä¸º â€”â€” å®ƒä¼šå°†å®ä¾‹å¯¹è±¡çš„ `__proto__` æŒ‡å‘æ„é€ å‡½æ•°çš„ `prototype`ã€‚è€Œä¸æ˜¯å»ç®¡ä½  `prototype` ä¸Šæœ‰æ²¡æœ‰ `constructor` å±æ€§ã€‚å› æ­¤ï¼Œå¦‚æœä½ æ‰‹åŠ¨é‡å†™äº† `prototype`ï¼Œ**é»˜è®¤çš„ `constructor` å±æ€§å°±ä¼šä¸¢å¤±**ï¼Œä»è€Œå¯¼è‡´ `a.constructor !== A`ã€‚

## ğŸ” ä» `new A()` çš„è§’åº¦çœ‹å‘ç”Ÿäº†ä»€ä¹ˆ

### âœ… æ‰§è¡Œ `new A()` å®é™…å‘ç”Ÿäº†ä»¥ä¸‹æ­¥éª¤ï¼š

```js
function A() {}
A.prototype = { sayHi() {} }; // ğŸš¨ ä½ æ‰‹åŠ¨æ”¹å†™äº† prototype å¯¹è±¡

const a = new A();
```

ç›¸å½“äº JavaScript å†…éƒ¨æ‰§è¡Œäº†ä¸‹é¢è¿™äº›æ­¥éª¤ï¼ˆç®€åŒ–ï¼‰ï¼š

### 1ï¸âƒ£ åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ `a`ï¼š

```js
const a = {}; // åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡
```

### 2ï¸âƒ£ å°†æ–°å¯¹è±¡çš„ `__proto__` æŒ‡å‘ `A.prototype`

```js
Object.setPrototypeOf(a, A.prototype); // å³ï¼ša.__proto__ = A.prototype
```

ç°åœ¨ï¼š

```js
a.__proto__ === A.prototype; // âœ… true
```

---

### ğŸ”¥ å…³é”®ç‚¹ï¼šä½ è‡ªå·±æ‰‹åŠ¨èµ‹å€¼äº† `A.prototype`

```js
A.prototype = {
  sayHi() {
    console.log("Hi");
  },
};
```

è¿™è¡Œä»£ç  **ç”¨ä¸€ä¸ªâ€œçº¯å¯¹è±¡â€æ›¿æ¢äº†åŸæœ‰çš„ `A.prototype` å¯¹è±¡**ï¼Œæ–°çš„è¿™ä¸ªå¯¹è±¡æ²¡æœ‰ `constructor` å±æ€§ã€‚JavaScript ä¸ä¼šå¸®ä½ è‡ªåŠ¨è¡¥ä¸Šã€‚

> åŸæœ¬ `A.prototype` æ˜¯é»˜è®¤ç”Ÿæˆçš„ï¼Œé•¿è¿™æ ·ï¼š

```js
A.prototype = {
  constructor: A, // é»˜è®¤å­˜åœ¨
  __proto__: Object.prototype,
};
```

è€Œä½ æ‰‹åŠ¨æ›¿æ¢ä¹‹åï¼š

```js
A.prototype = {
  sayHi() { ... }
}
// âŒ æ²¡æœ‰ constructor å±æ€§äº†
```

æ‰€ä»¥ï¼š

```js
((a.constructor === a.__proto__.constructor) === A.prototype.constructor) ===
  undefined;
```

äºæ˜¯ï¼š

```js
a.constructor === Object; // âŒ fallback åˆ° Object æ„é€ å‡½æ•°
```

## âœ… å¦‚ä½•ä¿®å¤ï¼Ÿ

ä½ åªéœ€æ‰‹åŠ¨æŠŠ `constructor` åŠ å›å»ï¼š

```js
A.prototype = {
  constructor: A, // ğŸ‘ˆ æ‰‹åŠ¨åŠ å›æ¥
  sayHi() {
    console.log("Hi");
  },
};
```

### åŸå‹é“¾ç»§æ‰¿

```javascript
function parent() {
  this.name = "parent";
  this.play = [1, 2, 3];
}

function child() {
  this.type = "child2";
}

//åŸå‹é“¾ç»§æ‰¿å®ç°æ–¹å¼ï¼Œå³æŒ‡å®šç»§æ‰¿ç±»çš„åŸå‹å¯¹è±¡ä¸ºçˆ¶ç±»å¯¹è±¡
child1.prototype = new parent();
child1.prototype.constructor = child1();
```

æ–¹æ³•ä¼˜ç‚¹ï¼š
è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼š å½“å‡ºç°ä¸¤ä¸ªå®ä¾‹å¯¹å…±äº«çˆ¶ç±»çš„å¼•ç”¨å¯¹è±¡ï¼Œå› ä¸ºä»–ä»¬çš„åŸå‹å¯¹è±¡å®é™…ä¸Šæ˜¯ new å‡ºæ¥çš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡

```javascript
var s1 = new Child2();
var s2 = new Child2();
s1.play.push(4);
console.log(s1.play, s2.play); // [1,2,3,4]
```

### æ„é€ å‡½æ•°ç»§æ‰¿

```javascript
function Parent() {
  this.name = "parent1";
}

Parent.prototype.getName = function () {
  return this.name;
};

function Child() {
  //æ„é€ å‡½æ•°ç»§æ‰¿å®ç°æ–¹å¼ï¼Œåœ¨ç»§æ‰¿ç±»çš„æ„é€ è¿‡ç¨‹ä¸­ä½¿ç”¨çˆ¶ç±»çš„callæ–¹æ³•ç»‘å®š
  Parent1.call(this);
  this.type = "child";
// ç¬¬ä¸€æ¬¡è°ƒç”¨ Parent3()
// åŸå‹é“¾ç»§æ‰¿
Child3.prototype = new Parent3();}

let child = new Child();
console.log(child); // æ²¡é—®é¢˜
console.log(child.getName()); // ä¼šæŠ¥é”™
```

ä¼˜ç‚¹ï¼š è§£å†³äº†åŸå‹é“¾ç»§æ‰¿é€ æˆçš„å…±äº«å¼•ç”¨å±æ€§é—®é¢˜
ç¼ºç‚¹ï¼š åªèƒ½ç»§æ‰¿çˆ¶ç±»çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ï¼Œæ— æ³•ç»§æ‰¿åŸå‹å±æ€§å’Œæ–¹æ³•

### ç»„åˆç»§æ‰¿

```javascript
function Parent3() {
  this.name = "parent3";
  this.play = [1, 2, 3];
}

Parent3.prototype.getName = function () {
  return this.name;
};
function Child3() {
  // ç¬¬äºŒæ¬¡è°ƒç”¨ Parent3()
  // æ„é€ å‡½æ•°ç»§æ‰¿
  Parent3.call(this);
  this.type = "child3";
}

// ç¬¬ä¸€æ¬¡è°ƒç”¨ Parent3()
// åŸå‹é“¾ç»§æ‰¿
Child3.prototype = new Parent3();
// æ‰‹åŠ¨æŒ‚ä¸Šæ„é€ å™¨ï¼ŒæŒ‡å‘è‡ªå·±çš„æ„é€ å‡½æ•°
Child3.prototype.constructor = Child3;
var s3 = new Child3();
var s4 = new Child3();
s3.play.push(4);
console.log(s3.play, s4.play); // ä¸äº’ç›¸å½±å“
console.log(s3.getName()); // æ­£å¸¸è¾“å‡º'parent3'
console.log(s4.getName()); // æ­£å¸¸è¾“å‡º'parent3'
```

ä¼˜ç‚¹ï¼š è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„é‡å¤é—®é¢˜å’Œæ„é€ å‡½æ•°ç»§æ‰¿çš„æ— æ³•ç»§æ‰¿åŸå‹å±æ€§é—®é¢˜
ç¼ºç‚¹ï¼š è°ƒç”¨ä¸¤æ¬¡çˆ¶ç±»çš„æ„é€ å‡½æ•°, ç”±äºå­ç±»æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¸ºçˆ¶ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œå¯¼è‡´é‡å¤äº†çˆ¶ç±»çš„å±æ€§å£°æ˜ï¼Œä¸ä¼šå¯¼è‡´é—®é¢˜ï¼Œä½†æ˜¯å¯¼è‡´äº†å†—ä½™ï¼Œå®é™…ä¸Šå¯ä»¥é€šè¿‡åŸå‹é“¾å‘ä¸Šå›æº¯æ‰¾åˆ°

### å¯„ç”Ÿç»„åˆç»§æ‰¿

> Object.create(proto) å½“è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œè¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œä¸”è¿™ä¸ªç©ºå¯¹è±¡çš„\_\_proto\_\_ === proto

```javascript
function Parent3() {
  this.name = "parent3";
  this.play = [1, 2, 3];
}

Parent3.prototype.getName = function () {
  return this.name;
};
function Child3() {
  // ç¬¬äºŒæ¬¡è°ƒç”¨ Parent3()
  // æ„é€ å‡½æ•°ç»§æ‰¿
  Parent3.call(this);
  this.type = "child3";
}
//åˆ›å»ºä¸€ä¸ªæ²¡æœ‰å®ä¾‹æ–¹æ³•çš„çˆ¶ç±»å¯¹è±¡ä½œä¸ºå­ç±»çš„åŸå‹å¯¹è±¡
Child3.prototype = Object.create(Parent3.prototype);
// æ‰‹åŠ¨æŒ‚ä¸Šæ„é€ å™¨ï¼ŒæŒ‡å‘è‡ªå·±çš„æ„é€ å‡½æ•°
Child3.prototype.constructor = Child3;
var s3 = new Child3();
var s4 = new Child3();
s3.play.push(4);
console.log(s3.play, s4.play); // ä¸äº’ç›¸å½±å“
console.log(s3.getName()); // æ­£å¸¸è¾“å‡º'parent3'
console.log(s4.getName()); // æ­£å¸¸è¾“å‡º'parent3'
```

ç¼ºç‚¹ï¼š åœ¨ Child3 æŒ‡å®šåŸå‹å¯¹è±¡å‰æ‰€æœ‰å®šä¹‰åœ¨åŸå‹ä¸Šçš„å±æ€§å°†ä¸¢å¤±
