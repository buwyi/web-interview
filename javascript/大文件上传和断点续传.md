# 大文件上传

在从客户端向服务端上传文件的过程中
我们面临的问题有

- 服务器处理数据的能力
- 请求超时
- 网络波动

所以如果需要上传一个文件较大的文件，可能会因为上面的问题导致上传失败
所以对于大文件，我们需要采取单独上传

### 分片上传

将需要上传的文件，从内容或者内存空间上来说，分为多个部分进行分片上传， 由客户端和服务端协商一个分片合并规则，最后由服务端将上传的文件分片整合成原始文件
大致流程如下：

- 按照协商的分片规则，将大文件分成相同大小的数据块
- 初始化一个分片任务，返回本次分片上传的唯一标识
- 按照一定策略上传分片
- 分送完成后，服务端判断文件是否完整，如果完整则合并成原始文件

### 断点续传

是指在上传或者下载的过程中，将下载或者上传任务分为几个部分，每一个部分采用一个线程进行上传或者下载如果碰到网络故障，可以从已经上传或下载的部分开始继续上传下载未完成的部分，而没有必要从头开始上传下载。用户可以节省时间，提高速度

一般实现方式有两种：

服务器端返回，告知从哪开始
浏览器端自行处理
上传过程中将文件在服务器写为临时文件，等全部写完了（文件上传完），将此临时文件重命名为正式文件即可

如果中途上传中断过，下次上传的时候根据当前临时文件大小，作为在客户端读取文件的偏移量，从此位置继续读取文件数据块，上传到服务器从此偏移量继续写入文件即可
