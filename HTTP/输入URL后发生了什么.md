# 输入URL后的进程发生过程

1. 用户输入url并且回车
2. 浏览器**进程**检查url, 组装协议，封装成完整的url
3. 浏览器**进程**通过进程间协议(IPC)， 将url请求发送给网络**进程**
4. 网络进程受到url后检查本地缓存中是否存在该内容，如果有则将资源返回给浏览器进程
5. 如果没有，网络进程向web服务器发起http请求，
   1. 进程DNS解析， (浏览器缓存 -> 系统缓存host -> 本地服务器 -> 远程服务器) ,获取服务器的ip地址
   2. 利用ip地址和服务器建立tcp连接(三次握手) ， 打开端口
   3. 构建请求头信息
   4. 发送请求头信息
   5. 服务器相应后，网络进程接受响应头和信息，并解析响应内容。
      1. >初始请求的响应包含所接收数据的第一个字节。首字节时间（TTFB）是用户通过点击链接进行请求与收到第一个 HTML 数据包之间的时间。第一个内容分块通常是 14KB 的数据
      2. 网络进程解析响应流程：
         1. 检查状态码，如果是301/302需要重定向， 从Location中重新读取地址，再次发送请求头信息，如果是200,则继续处理请求
         2. 200响应处理，检查响应类型Content-type, 如果是字节流类型，则将该请求下发到下载管理器，该导航流程结束，不再进行后续渲染，如果是html则通知浏览器进程准备渲染进程
6. 准备渲染进程
   1. 渲染进程存在复用机制，当前url若和之前打开的渲染进程根域名相同，则利用之前的渲染进程，不同开启新的渲染进程
7. 传输数据，更新状态
   1. 渲染进程准备完毕后，浏览器进程通过IPC向渲染进程发送文档消息，渲染进程受到消息后和网络进程建立传输数据的管道
   2. 渲染进程收集完数据后，发送浏览器进程“确认提交”
   3. 浏览器进程接收到确认消息后更新浏览器界面状态：安全、地址栏 url、前进后退的历史状态、更新 web 页面
   4. 渲染进程开始渲染
8. 页面渲染



## 301&308、 302&307  永久和临时，不维持原请求头和维持原请求头
HTTP状态码301和308、302与307都是重定向状态码，它们之间的主要区别在于重定向的持久性和客户端的行为规范。
- **301 Moved Permanently（永久移动）**：当服务器返回301状态码时，它指示请求的资源已被永久地移至新的URL，并且将来对该资源的所有请求都应使用新的URL。搜索引擎和其他自动化工具会更新索引以指向新位置。浏览器在接收到这个响应后，将不再尝试使用原始URL访问资源，而是直接使用响应中`Location`头指定的新URL。
- **308 Permanent Redirect（永久重定向）**：308状态码是HTTP/1.1协议后来增加的一个状态码，其语义与301类似，也是永久性重定向，但特别适用于那些需要保持请求方法不变的情况。例如，在PUT或POST请求中，301可能会导致浏览器错误地使用GET方法重试请求到新位置，而308确保了客户端会用相同的方法重新发起请求。
- **302 Found（临时移动）**：302状态码意味着资源暂时存在于新的URL下，通常用于临时性的重定向场景，如维护期间的临时跳转或根据用户行为动态生成内容的场景。尽管规范建议客户端后续请求继续使用原URL，但在实际应用中，大多数浏览器也会遵循Location头进行重定向。
- **307 Temporary Redirect（临时重定向）**：307类似于302，表示请求的资源临时位于不同的URL上，但它更明确地要求浏览器或其他用户代理保持原始请求方法并在新的URL上执行相同的请求方法。这意味着如果是POST请求，重定向时也必须对新的URL执行POST操作，而不是像处理302时那样可能改为GET请求。

## 响应头中的content-Type是什么
他是浏览器进程能正确识别响应内容的告知者，告诉浏览器服务器返回的相应主体的媒体类型(MIME) 和字符编码格式，用于防止浏览器错误的(本来是网页被加载成纯文本)， 错误的执行(本应该下载的文件被当成html执行，从而导致跨站脚本攻击)。

由三个部分组成，`Content-Type: <media-type>; charset=<character-encoding>`
- media-type，也成为MIME类型，用于定义数据的性质和格式，他由类型和子类型组成，用/分割
  - 类型，大类别，比如：text, image, application, audio, video
  - 子类型，大类别下的具体类型
  - 所以media-type可以是，text/html, image/png, application/json
- charset, 字符集，可选择参数，用于指定文本内容的编码格式，例如utf-8

常用的content-type如下所示
text/html; charset=utf-8, html文件，使用渲染进程进行渲染
text/plain  纯文本内容，直接显示源码
application/javascript或者text/javascript  可执行JS文件
application/json  常用于restfulapi的响应